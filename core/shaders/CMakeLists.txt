set(SHADER_PATH ${CMAKE_CURRENT_SOURCE_DIR})

file(GLOB VERTEX_SHADER_FILES "*.vert")
file(GLOB FRAGMENT_SHADER_FILES "*.frag")

set(SHADER_COMMANDS "cd ${SHADER_PATH}/")

foreach(VERTEX_SHADER_FILE ${VERTEX_SHADER_FILES})
    get_filename_component(VERTEX_SHADER_FILENAME ${VERTEX_SHADER_FILE} NAME)
    string(REGEX REPLACE ".vert" "" VERTEX_SHADER_FILENAME_NO_EXTENSION ${VERTEX_SHADER_FILENAME})
    list(APPEND SHADER_COMMANDS "\n${VULKAN_GLSLC_PATH} ${VERTEX_SHADER_FILENAME_NO_EXTENSION}.vert -o ${VERTEX_SHADER_FILENAME_NO_EXTENSION}_vert.spv")
endforeach()

foreach(FRAGMENT_SHADER_FILE ${FRAGMENT_SHADER_FILES})
    get_filename_component(FRAGMENT_SHADER_FILENAME ${FRAGMENT_SHADER_FILE} NAME)
    string(REGEX REPLACE ".frag" "" FRAGMENT_SHADER_FILENAME_NO_EXTENSION ${FRAGMENT_SHADER_FILENAME})
    list(APPEND SHADER_COMMANDS "\n${VULKAN_GLSLC_PATH} ${FRAGMENT_SHADER_FILENAME_NO_EXTENSION}.frag -o ${FRAGMENT_SHADER_FILENAME_NO_EXTENSION}_frag.spv")
endforeach()

file(WRITE ${SHADER_PATH}/compile_shaders.bat ${SHADER_COMMANDS})

add_custom_target(
    CompileShaders ALL
    COMMENT "Compiling Shaders..."
    COMMAND ${SHADER_PATH}/compile_shaders.bat
)

file(GLOB SHADER_FILES "*.spv")
file(COPY ${SHADER_FILES} DESTINATION ${SANDBOX_BIN_DIR}/shaders/)